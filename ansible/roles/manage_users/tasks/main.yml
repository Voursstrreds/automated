- name: Manage usergroups
  ansible.builtin.group:
    name: "{{ item }}"
    state: present
  loop: "{{ usergroups }}"

- name: Manage users
  ansible.builtin.include_role:
    name: bouncmpe.automate.manage_single_user
  vars:
    username: "{{ item.name }}"
    usergroups: "{{ item.groups | default(users_group) }}"
    state: "{{ item.state | default('present') }}"
    remove: "{{ item.remove | default(false) }}"
    ssh_import_id: "{{ item.ssh_import_id }}"
  loop: "{{ users }}"
